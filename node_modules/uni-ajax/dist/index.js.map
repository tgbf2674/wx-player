{"version":3,"file":"index.js","sources":["../src/lib/core/InterceptorManager.js","../src/lib/adapters/Request.js","../src/lib/helpers/isCallback.js","../src/lib/utils.js","../src/lib/helpers/detachConfig.js","../src/lib/helpers/mergeConfig.js","../src/lib/helpers/originURL.js","../src/lib/helpers/buildURL.js","../src/lib/helpers/combineURL.js","../src/lib/adapters/http.js","../src/lib/defaults.js","../src/lib/core/dispatchRequest.js","../src/lib/core/handleCancel.js","../src/lib/core/Ajax.js","../src/index.js"],"sourcesContent":["/**\n * 拦截器类\n */\nexport default class InterceptorManager {\n  handlers = []\n\n  constructor() {\n    this.forEach = {\n      asc: fn => {\n        for (let i = 0, l = this.handlers.length; i < l; i++) {\n          this.handlers[i] !== null && fn(this.handlers[i])\n        }\n      },\n      desc: fn => {\n        for (let i = this.handlers.length - 1; i >= 0; i--) {\n          this.handlers[i] !== null && fn(this.handlers[i])\n        }\n      }\n    }\n  }\n\n  use(fulfilled, rejected) {\n    this.handlers.push({\n      fulfilled,\n      rejected\n    })\n    return this.handlers.length - 1\n  }\n  eject(id) {\n    if (this.handlers[id]) {\n      this.handlers[id] = null\n    }\n  }\n}\n","export default function RequestConstructor() {\n  return class Request extends Promise {\n    // RequestTask 对象\n    static task = null\n    // 请求任务是否被中断\n    static aborted = false\n    // 监听 HTTP Response Header 事件回调函数\n    static onHeadersReceivedCallback = null\n    // 取消监听 HTTP Response Header 事件回调函数\n    static offHeadersReceivedCallback = null\n\n    // 监听 HTTP Response Header 事件执行函数\n    static onHeadersReceived(fn) {\n      if (typeof fn === 'function') {\n        Request.onHeadersReceivedCallback = fn\n      }\n      if (Request.onHeadersReceivedCallback && Request.task) {\n        Request.task.onHeadersReceived?.(Request.onHeadersReceivedCallback)\n      }\n    }\n    // 取消监听 HTTP Response Header 事件执行函数\n    static offHeadersReceived(fn) {\n      if (typeof fn === 'function') {\n        Request.offHeadersReceivedCallback = fn\n      }\n      if (Request.offHeadersReceivedCallback && Request.task) {\n        Request.task.offHeadersReceived?.(Request.offHeadersReceivedCallback)\n      }\n    }\n\n    // 中断请求任务\n    abort() {\n      Request.aborted = true\n      Request.task?.abort()\n      return this\n    }\n    // 监听 HTTP Response Header 事件\n    onHeadersReceived(fn) {\n      Request.onHeadersReceived(fn)\n      return this\n    }\n    // 取消监听 HTTP Response Header 事件\n    offHeadersReceived(fn) {\n      Request.offHeadersReceived(fn)\n      return this\n    }\n  }\n}\n","/**\n * 判断参数是否含有回调参数 success / fail / complete 之一\n * @param {string} field 参数的 Key 值字符串\n * @returns {boolean} 返回判断值\n */\nexport default function isCallback(field) {\n  return ['success', 'fail', 'complete'].includes(field)\n}\n","/**\n * 获取值的原始类型字符串，例如 [object Object]\n */\nconst _toString = Object.prototype.toString\n\n/**\n * 判断是否为数组\n * @param {*} val 要判断的值\n * @returns {boolean} 返回判断结果\n */\nexport function isArray(val) {\n  return _toString.call(val) === '[object Array]'\n}\n\n/**\n * 判断是否为普通对象\n * @param {*} val 要判断的值\n * @returns {boolean} 返回判断结果\n */\nexport function isPlainObject(val) {\n  return _toString.call(val) === '[object Object]'\n}\n\n/**\n * 遍历\n * @param {object|array} obj 要迭代的对象\n * @param {function} fn 为每个项调用的回调\n */\nexport function forEach(obj, fn) {\n  if (obj === null || obj === undefined) return\n  if (typeof obj !== 'object') obj = [obj]\n  if (isArray(obj)) {\n    for (let i = 0, l = obj.length; i < l; i++) {\n      fn.call(null, obj[i], i, obj)\n    }\n  } else {\n    for (const k in obj) {\n      if (Object.prototype.hasOwnProperty.call(obj, k)) {\n        fn.call(null, obj[k], k, obj)\n      }\n    }\n  }\n}\n\n/**\n * 对象深合并\n * @param  {...object} args 对象\n * @returns {object} 合并后的对象\n */\nexport function merge(...args) {\n  const result = {}\n  for (let i = 0, l = args.length; i < l; i++) {\n    if (isPlainObject(args[i])) {\n      forEach(args[i], (val, key) => {\n        result[key] = assign(result[key], val)\n      })\n    }\n  }\n  return result\n}\n\n/**\n * 合并分配到目标对象\n * @param {*} target 目标对象\n * @param {*} source 源对象\n * @returns {*} 目标对象\n */\nexport function assign(target, source) {\n  if (isPlainObject(target) && isPlainObject(source)) {\n    return merge(target, source)\n  } else if (isPlainObject(source)) {\n    return merge({}, source)\n  } else if (isArray(source)) {\n    return source.slice()\n  }\n  return source\n}\n\n/**\n * trycatch 封装函数\n * @param {function} fn 函数\n * @returns {function} 封装 trycatch 后的函数\n */\nexport function tryCatch(fn) {\n  return function () {\n    try {\n      return fn.apply(fn, arguments)\n    } catch (error) {\n      console.error(error)\n    }\n  }\n}\n","import isCallback from './isCallback'\nimport { forEach, tryCatch } from '../utils'\n\n/**\n * 分离请求对象\n * @param {string|object} [url] 请求地址 / 请求配置\n * @param {string|object} [data] 请求参数\n * @param {object} [config] 请求配置\n * @returns {object} 回调函数对象 去除回调的请求参数\n */\nexport default function detachConfig(url, data, config) {\n  // 回调函数对象\n  let callback = null\n  // 去除回调的请求参数对象\n  const options = {}\n\n  // 是否传入单个参数\n  const isSingle = typeof url === 'object'\n\n  // 请求参数对象\n  const value = isSingle ? url : { ...config, url, data }\n\n  // 分离请求参数\n  forEach(value, (val, key) => {\n    if (isSingle && isCallback(key)) {\n      ;(callback || (callback = {}))[key] = tryCatch(val)\n    } else {\n      options[key] = val\n    }\n  })\n\n  return {\n    callback,\n    config: options\n  }\n}\n","import { assign, forEach } from '../utils'\n\n/**\n * 合并请求配置（深度合并，且不合并 undefined 值）\n * @param {object} config1 前请求配置\n * @param {object} [config2] 后请求配置\n * @returns {object} 合并后的请求配置\n */\nexport default function mergeConfig(config1, config2 = {}) {\n  const config = {}\n\n  const configKeys = Object.keys({ ...config1, ...config2 })\n\n  forEach(configKeys, prop => {\n    if (config2[prop] !== undefined) {\n      config[prop] = assign(config1[prop], config2[prop])\n    } else if (config1[prop] !== undefined) {\n      config[prop] = assign(undefined, config1[prop])\n    }\n  })\n\n  config.method = config.method.toUpperCase()\n\n  return config\n}\n","/**\n * 根据 baseURL 获取源地址\n * @param {string} baseURL 请求跟地址\n * @returns {string} 源地址\n */\nexport default function originURL(baseURL = '') {\n  // 判断是否 http:// 或 https:// 开头\n  if (!/^https?:\\/\\//.test(baseURL)) return ''\n  const u = baseURL.split('/')\n  return u[0] + '//' + u[2]\n}\n","import { forEach, isArray } from '../utils'\n\n/**\n * 根据params编译请求URL\n * @param {string} url 请求URL\n * @param {*} params URL参数\n */\nexport default function buildURL(url, params) {\n  if (!params) return url\n\n  let query\n\n  const parts = []\n  forEach(params, (val, key) => {\n    if (val === null || typeof val === 'undefined') return\n\n    if (isArray(val)) key = key + '[]'\n    else val = [val]\n\n    forEach(val, v => {\n      if (v !== null && typeof v === 'object') {\n        v = JSON.stringify(v)\n      }\n      parts.push(encode(key) + '=' + encode(v))\n    })\n  })\n  query = parts.join('&')\n\n  if (query) {\n    const hashmarkIndex = url.indexOf('#')\n    hashmarkIndex !== -1 && (url = url.slice(0, hashmarkIndex))\n    url += (url.indexOf('?') === -1 ? '?' : '&') + query\n  }\n\n  return url\n}\n\nfunction encode(val) {\n  return encodeURIComponent(val)\n    .replace(/%3A/gi, ':')\n    .replace(/%24/g, '$')\n    .replace(/%2C/gi, ',')\n    .replace(/%20/g, '+')\n    .replace(/%5B/gi, '[')\n    .replace(/%5D/gi, ']')\n}\n","/**\n * 根据 baseURL 和 url 拼接\n * @param {string} baseURL 请求跟地址\n * @param {string} relativeURL 请求参数地址\n * @returns {string} 拼接后的地址\n */\nexport default function combineURL(baseURL = '', relativeURL = '') {\n  // 判断是否 http:// 或 https:// 开头\n  if (/^https?:\\/\\//.test(relativeURL)) return relativeURL\n  // 去除 baseURL 结尾斜杠，去除 relativeURL 开头斜杠，再判断拼接\n  return relativeURL ? baseURL.replace(/\\/+$/, '') + '/' + relativeURL.replace(/^\\/+/, '') : baseURL\n}\n","export default function adapter(config, Request) {\n  return new Promise((resolve, reject) => {\n    // 判断是否被取消请求\n    if (Request.aborted) {\n      return reject({\n        config,\n        errMsg: 'request:fail abort'\n      })\n    }\n\n    // 发起请求，并挂载 RequestTask\n    Request.task = uni.request({\n      ...config,\n      complete: result => {\n        // 根据状态码判断要执行的触发的状态\n        const response = { config, ...result }\n        !config.validateStatus || config.validateStatus(result.statusCode)\n          ? resolve(response)\n          : reject(response)\n      }\n    })\n\n    // 请求类内部判断是否执行监听 HTTP Response Header 事件\n    Request.onHeadersReceived()\n    Request.offHeadersReceived()\n\n    // 根据配置的 xhr 属性执行获取 RequestTask\n    config.xhr?.(Request.task, config)\n  })\n}\n","import adapter from './adapters/http'\nimport { forEach } from './utils'\n\nexport const METHOD = ['get', 'post', 'put', 'delete', 'connect', 'head', 'options', 'trace']\nexport const HEADER = ['common', ...METHOD]\n\nconst defaults = {\n  adapter,\n  header: {},\n  method: 'get',\n  timeout: 30000,\n  dataType: 'json',\n  responseType: 'text',\n  sslVerify: true,\n  withCredentials: false,\n  firstIpv4: false,\n  validateStatus: statusCode => statusCode >= 200 && statusCode < 300\n}\n\nforEach(HEADER, h => (defaults.header[h] = {}))\n\nexport default defaults\n","import buildURL from '../helpers/buildURL'\nimport combineURL from '../helpers/combineURL'\nimport isCallback from '../helpers/isCallback'\nimport { forEach, isPlainObject, merge } from '../utils'\nimport { HEADER } from '../defaults'\n\n/**\n * 派发请求方法\n * @param {*} Request 请求类\n * @returns {Promise} 执行请求方法Promise\n */\nexport default function dispatchRequest(Request) {\n  return config => {\n    // 拼接 url\n    config.url = buildURL(combineURL(config.baseURL, config.url), config.params)\n\n    // 请求方法转大写\n    config.method = (config.method || 'get').toUpperCase()\n\n    // 调整 header 优先级\n    config.header = merge(\n      config.header.common,\n      config.header[config.method.toLowerCase()],\n      config.header\n    )\n\n    // 清除多余的请求头\n    forEach(HEADER, h => isPlainObject(config.header[h]) && delete config.header[h])\n\n    // 清除回调函数\n    forEach(config, (val, key) => isCallback(key) && delete config[key])\n\n    // 执行请求方法\n    return config.adapter(config, Request)\n  }\n}\n","/**\n * 派发请求拒绝方法，处理发起请求前错误，取消执行请求，并防止进入响应拦截器\n * @param {*} reason 错误原因\n * @returns {Promise} 封装了 __CANCEL__ 的失败对象\n */\nexport function dispatchCancel(reason) {\n  return Promise.reject({\n    reason,\n    __CANCEL__: true\n  })\n}\n\n/**\n * 拦截失败对象\n * @param {Function} rejected 响应错误拦截器\n */\nexport function interceptCancel(rejected) {\n  // 判断发起请求前是否发生错误，如果发生错误则不执行后面的响应错误拦截器\n  return (\n    rejected && (response => (response.__CANCEL__ ? Promise.reject(response) : rejected(response)))\n  )\n}\n\n/**\n * 分离失败对象\n * @param {*} response 封装了 __CANCEL__ 的失败对象\n */\nexport function detachCancel({ __CANCEL__, ...error }) {\n  return Promise.reject(__CANCEL__ ? error.reason : error)\n}\n","import InterceptorManager from './InterceptorManager'\nimport RequestConstructor from '../adapters/Request'\nimport detachConfig from '../helpers/detachConfig'\nimport mergeConfig from '../helpers/mergeConfig'\nimport originURL from '../helpers/originURL'\nimport dispatchRequest from './dispatchRequest'\nimport { detachCancel, dispatchCancel, interceptCancel } from './handleCancel'\nimport defaults, { METHOD } from '../defaults'\nimport { forEach } from '../utils'\n\nexport default class Ajax {\n  constructor(config) {\n    // 赋值到实例配置\n    this.config = config\n\n    // 挂载拦截器\n    this.request.interceptors = {\n      request: new InterceptorManager(),\n      response: new InterceptorManager()\n    }\n\n    // 挂载修改 config 方法\n    this.request.config = async fn => (this.config = await fn(this._config))\n\n    // 挂载对应的 method 方法\n    forEach(METHOD, method => {\n      this.request[method] = (url, data, config) =>\n        this.request(\n          ...(typeof url === 'string' ? [url, data, { ...config, method }] : [{ ...url, method }])\n        )\n    })\n\n    // 挂载实例接口地址\n    setTimeout(async () => {\n      this.request.baseURL = (await this.config).baseURL || ''\n      this.request.origin = originURL(this.request.baseURL)\n    })\n  }\n\n  set config(config) {\n    this._config =\n      typeof config === 'function'\n        ? async () => mergeConfig(defaults, await config())\n        : mergeConfig(defaults, config)\n  }\n  get config() {\n    return typeof this._config === 'function' ? this._config() : this._config\n  }\n\n  request = (...args) => {\n    // 分类请求参数\n    const { callback, config } = detachConfig(...args)\n\n    // 创建请求类\n    const Request = RequestConstructor()\n\n    // 声明 Promise 链\n    const chain = [dispatchRequest(Request), dispatchCancel]\n\n    // 将请求拦截遍历添加到链前面\n    this.request.interceptors.request.forEach.desc(({ fulfilled, rejected }) =>\n      chain.unshift(fulfilled, rejected)\n    )\n\n    // 将响应拦截遍历添加到链后面\n    this.request.interceptors.response.forEach.asc(({ fulfilled, rejected }) =>\n      chain.push(fulfilled, interceptCancel(rejected))\n    )\n\n    // 先执行获取 config 请求配置\n    chain.unshift(async config => mergeConfig(await this.config, config), undefined)\n\n    // 处理发起请求前的错误数据\n    chain.push(undefined, detachCancel)\n\n    // 调用请求方法后，且拦截器触发完成后，判断回调参数的执行\n    chain.push(\n      response => {\n        if (!callback) return response\n        callback.success?.(response)\n        callback.complete?.(response)\n      },\n      error => {\n        if (!callback) return Promise.reject(error)\n        callback.fail?.(error)\n        callback.complete?.(error)\n      }\n    )\n\n    // 创建请求Promise，遍历链将链上方法传递到then回调\n    let request = Request.resolve(config)\n    while (chain.length) {\n      request = request.then(chain.shift(), chain.shift())\n    }\n\n    return request\n  }\n}\n","import Ajax from './lib/core/Ajax'\n\nfunction createInstance(defaultConfig) {\n  return new Ajax(defaultConfig).request\n}\n\nconst ajax = createInstance()\n\najax.create = function create(instanceConfig) {\n  return createInstance(instanceConfig)\n}\n\nexport default ajax\n"],"names":["InterceptorManager","constructor","forEach","asc","fn","i","l","handlers","length","desc","use","fulfilled","rejected","push","eject","id","RequestConstructor","Request","Promise","onHeadersReceived","onHeadersReceivedCallback","task","offHeadersReceived","offHeadersReceivedCallback","abort","aborted","isCallback","field","includes","_toString","Object","prototype","toString","isArray","val","call","isPlainObject","obj","undefined","k","hasOwnProperty","merge","args","result","key","assign","target","source","slice","tryCatch","apply","arguments","error","console","detachConfig","url","data","config","callback","options","isSingle","value","mergeConfig","config1","config2","configKeys","keys","prop","method","toUpperCase","originURL","baseURL","test","u","split","buildURL","params","query","parts","v","JSON","stringify","encode","join","hashmarkIndex","indexOf","encodeURIComponent","replace","combineURL","relativeURL","adapter","resolve","reject","errMsg","uni","request","complete","response","validateStatus","statusCode","xhr","METHOD","HEADER","defaults","header","timeout","dataType","responseType","sslVerify","withCredentials","firstIpv4","h","dispatchRequest","common","toLowerCase","dispatchCancel","reason","__CANCEL__","interceptCancel","detachCancel","Ajax","chain","interceptors","unshift","success","fail","then","shift","_config","setTimeout","origin","createInstance","defaultConfig","ajax","create","instanceConfig"],"mappings":"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"}